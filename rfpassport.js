let recognized_data = [{"language":"ru","location":{"height":30,"width":32,"x":321,"y":1710},"text":"о"},{"language":"ru","location":{"height":27,"width":32,"x":321,"y":1656},"text":"с"},{"language":"ru","location":{"height":28,"width":32,"x":321,"y":1608},"text":"с"},{"language":"ru","location":{"height":32,"width":32,"x":321,"y":1549},"text":"и"},{"language":"ru","location":{"height":37,"width":32,"x":321,"y":1432},"text":"с"},{"language":"ru","location":{"height":32,"width":32,"x":321,"y":1373},"text":"к"},{"language":"ru","location":{"height":28,"width":32,"x":320,"y":1318},"text":"а"},{"language":"ru","location":{"height":22,"width":32,"x":320,"y":1276},"text":"я"},{"language":"ru","location":{"height":27,"width":29,"x":322,"y":1006},"text":"Е"},{"language":"ru","location":{"height":28,"width":28,"x":322,"y":953},"text":"Р"},{"language":"ru","location":{"height":28,"width":28,"x":322,"y":900},"text":"А"},{"language":"ru","location":{"height":28,"width":28,"x":322,"y":847},"text":"Ц"},{"language":"ru","location":{"height":27,"width":28,"x":322,"y":747},"text":"я"},{"language":"ru","location":{"height":96,"width":20,"x":450,"y":1793},"text":"Паспорт"},{"language":"ru","location":{"height":66,"width":20,"x":450,"y":1716},"text":"выдан"},{"language":"ru","location":{"height":52,"width":41,"x":424,"y":1468},"text":"ТП"},{"language":"ru","location":{"height":73,"width":41,"x":423,"y":1369},"text":"№1"},{"language":"ru","location":{"height":135,"width":41,"x":422,"y":1167},"text":"ГОР."},{"language":"ru","location":{"height":272,"width":42,"x":420,"y":868},"text":"ПОДОЛЬСКЕ"},{"language":"ru","location":{"height":146,"width":40,"x":496,"y":1493},"text":"ОУФМС"},{"language":"ru","location":{"height":179,"width":41,"x":495,"y":1280},"text":"РОССИИ"},{"language":"ru","location":{"height":66,"width":40,"x":495,"y":1189},"text":"ПО"},{"language":"ru","location":{"height":301,"width":41,"x":494,"y":863},"text":"МОСКОВСКОЙ"},{"language":"ru","location":{"height":118,"width":40,"x":493,"y":720},"text":"ОБЛ."},{"language":"ru","location":{"height":119,"width":39,"x":571,"y":1253},"text":"гор."},{"language":"ru","location":{"height":272,"width":41,"x":569,"y":953},"text":"подольске"},{"language":"ru","location":{"height":205,"width":44,"x":660,"y":930},"text":"500-120"},{"language":"ru","location":{"height":55,"width":35,"x":687,"y":1834},"text":"Дата"},{"language":"ru","location":{"height":83,"width":34,"x":678,"y":1742},"text":"выдачи"},{"language":"ru","location":{"height":74,"width":29,"x":674,"y":1653},"text":"23."},{"language":"ru","location":{"height":72,"width":26,"x":674,"y":1566},"text":"04."},{"language":"ru","location":{"height":106,"width":29,"x":675,"y":1440},"text":"2008"},{"language":"ru","location":{"height":41,"width":27,"x":679,"y":1376},"text":"Код"},{"language":"ru","location":{"height":169,"width":31,"x":681,"y":1196},"text":"подразделения"},{"language":"ru","location":{"height":84,"width":20,"x":869,"y":912},"text":"Личный"},{"language":"ru","location":{"height":39,"width":19,"x":870,"y":864},"text":"код"},{"language":"ru","location":{"height":84,"width":20,"x":1026,"y":938},"text":"Анчная"},{"language":"ru","location":{"height":93,"width":20,"x":1026,"y":836},"text":"подпить"},{"language":"ru","location":{"height":108,"width":25,"x":1388,"y":1893},"text":"россия"},{"language":"ru","location":{"height":108,"width":26,"x":1386,"y":1451},"text":"россия"},{"language":"ru","location":{"height":110,"width":26,"x":1384,"y":1004},"text":"россия"},{"language":"ru","location":{"height":89,"width":18,"x":1467,"y":1404},"text":"Фамилия"},{"language":"ru","location":{"height":237,"width":39,"x":1433,"y":1017},"text":"богданов"},{"language":"ru","location":{"height":96,"width":20,"x":1680,"y":1398},"text":"Отчество"},{"language":"ru","location":{"height":180,"width":43,"x":1582,"y":1049},"text":"сергей"},{"language":"ru","location":{"height":89,"width":36,"x":1604,"y":1017},"text":"россии"},{"language":"ru","location":{"height":289,"width":44,"x":1651,"y":1003},"text":"АЛЕКСЕЕВИЧ"},{"language":"ru","location":{"height":108,"width":24,"x":1614,"y":554},"text":"РОССИЯ"},{"language":"ru","location":{"height":40,"width":30,"x":1695,"y":594},"text":"00"},{"language":"ru","location":{"height":51,"width":21,"x":1725,"y":1219},"text":"Дата"},{"language":"ru","location":{"height":106,"width":20,"x":1753,"y":1165},"text":"рождения"},{"language":"ru","location":{"height":300,"width":42,"x":1734,"y":811},"text":"25.03.1963"},{"language":"ru","location":{"height":62,"width":18,"x":1798,"y":1429},"text":"Места"},{"language":"ru","location":{"height":104,"width":18,"x":1825,"y":1389},"text":"рождения"},{"language":"ru","location":{"height":122,"width":39,"x":1793,"y":1232},"text":"ГОР."},{"language":"ru","location":{"height":235,"width":40,"x":1794,"y":973},"text":"ПОДОЛЬСК"},{"language":"ru","location":{"height":108,"width":25,"x":1834,"y":1002},"text":"россия"},{"language":"ru","location":{"height":302,"width":45,"x":1865,"y":1051},"text":"московской"},{"language":"ru","location":{"height":119,"width":42,"x":1871,"y":903},"text":"обл."},{"language":"en","location":{"height":32,"width":29,"x":1920,"y":598},"text":"co"},{"language":"ru","location":{"height":110,"width":25,"x":2066,"y":1887},"text":"россия"},{"language":"ru","location":{"height":107,"width":26,"x":2064,"y":1444},"text":"россия"},{"language":"ru","location":{"height":108,"width":25,"x":2062,"y":1002},"text":"россия"},{"language":"ru","location":{"height":108,"width":24,"x":2063,"y":554},"text":"россия"}]

// let recognized_data = [{"language":"ru","location":{"height":33,"width":31,"x":997,"y":975},"text":"с"},{"language":"ru","location":{"height":33,"width":29,"x":1057,"y":975},"text":"с"},{"language":"ru","location":{"height":33,"width":29,"x":1107,"y":975},"text":"и"},{"language":"ru","location":{"height":33,"width":32,"x":1165,"y":975},"text":"и"},{"language":"ru","location":{"height":33,"width":29,"x":1226,"y":975},"text":"с"},{"language":"ru","location":{"height":33,"width":29,"x":1276,"y":975},"text":"к"},{"language":"ru","location":{"height":33,"width":28,"x":1334,"y":975},"text":"а"},{"language":"ru","location":{"height":33,"width":29,"x":1383,"y":975},"text":"я"},{"language":"ru","location":{"height":33,"width":33,"x":1544,"y":975},"text":"е"},{"language":"ru","location":{"height":33,"width":29,"x":1598,"y":975},"text":"д"},{"language":"ru","location":{"height":33,"width":29,"x":1656,"y":975},"text":"е"},{"language":"ru","location":{"height":33,"width":25,"x":1706,"y":975},"text":"р"},{"language":"ru","location":{"height":33,"width":29,"x":1752,"y":975},"text":"а"},{"language":"ru","location":{"height":33,"width":33,"x":1867,"y":975},"text":"и"},{"language":"ru","location":{"height":33,"width":23,"x":1921,"y":975},"text":"я"},{"language":"ru","location":{"height":40,"width":300,"x":1064,"y":1064},"text":"отделением"},{"language":"ru","location":{"height":40,"width":118,"x":1394,"y":1063},"text":"уфмс"},{"language":"ru","location":{"height":40,"width":178,"x":1538,"y":1063},"text":"россии"},{"language":"ru","location":{"height":22,"width":102,"x":789,"y":1102},"text":"Паспорт"},{"language":"ru","location":{"height":21,"width":61,"x":900,"y":1102},"text":"выдан"},{"language":"ru","location":{"height":40,"width":67,"x":1098,"y":1144},"text":"по"},{"language":"ru","location":{"height":40,"width":363,"x":1191,"y":1144},"text":"новгородской"},{"language":"ru","location":{"height":40,"width":208,"x":1585,"y":1144},"text":"области"},{"language":"ru","location":{"height":40,"width":37,"x":1168,"y":1227},"text":"в"},{"language":"ru","location":{"height":41,"width":271,"x":1235,"y":1226},"text":"чудовском"},{"language":"ru","location":{"height":41,"width":180,"x":1537,"y":1226},"text":"районе"},{"language":"ru","location":{"height":42,"width":303,"x":966,"y":1309},"text":"08.11.2014"},{"language":"ru","location":{"height":20,"width":48,"x":800,"y":1343},"text":"Дата"},{"language":"ru","location":{"height":20,"width":84,"x":857,"y":1342},"text":"выдачи"},{"language":"ru","location":{"height":20,"width":39,"x":1270,"y":1340},"text":"Код"},{"language":"ru","location":{"height":20,"width":165,"x":1318,"y":1340},"text":"подразделения"},{"language":"ru","location":{"height":40,"width":209,"x":1701,"y":1298},"text":"530-022"},{"language":"en","location":{"height":24,"width":32,"x":2066,"y":1455},"text":"co"},{"language":"ru","location":{"height":23,"width":92,"x":1684,"y":1520},"text":"Личный"},{"language":"ru","location":{"height":22,"width":42,"x":1785,"y":1522},"text":"кол"},{"language":"ru","location":{"height":28,"width":33,"x":2073,"y":1585},"text":"сл"},{"language":"ru","location":{"height":21,"width":87,"x":1757,"y":1680},"text":"подпись"},{"language":"ru","location":{"height":41,"width":82,"x":1268,"y":1723},"text":"022"},{"language":"ru","location":{"height":43,"width":274,"x":1544,"y":2074},"text":"клименков"},{"language":"ru","location":{"height":44,"width":129,"x":1606,"y":2215},"text":"юрий"},{"language":"en","location":{"height":23,"width":32,"x":2066,"y":2198},"text":"co"},{"language":"ru","location":{"height":19,"width":91,"x":1190,"y":2318},"text":"Отчество"},{"language":"ru","location":{"height":19,"width":37,"x":1191,"y":2390},"text":"Пал"},{"language":"ru","location":{"height":20,"width":50,"x":1413,"y":2362},"text":"Дата"},{"language":"ru","location":{"height":40,"width":125,"x":1264,"y":2354},"text":"МУЖ."},{"language":"ru","location":{"height":20,"width":100,"x":1412,"y":2391},"text":"рождения"},{"language":"ru","location":{"height":44,"width":276,"x":1542,"y":2297},"text":"борисович"},{"language":"ru","location":{"height":44,"width":303,"x":1653,"y":2355},"text":"09.04.1977"},{"language":"ru","location":{"height":18,"width":96,"x":1191,"y":2464},"text":"рождения"},{"language":"ru","location":{"height":42,"width":73,"x":1524,"y":2440},"text":"г."},{"language":"ru","location":{"height":42,"width":204,"x":1624,"y":2440},"text":"ташкент"},{"language":"en","location":{"height":44,"width":1226,"x":757,"y":2728},"text":"PNRUSKLIMENKOV<<7RIA<BORISOVI3<<<<<<<<<<<"},{"language":"en","location":{"height":50,"width":1335,"x":754,"y":2810},"text":"4910907758RUS7704097M<<<<<<<4141108530022<58"}]


let google_sheet_data = [["ОМВД  г. Душанбе","DIA in Dushanbe"],["ОМВД Хатлонской области","DIA in Khatlon"],["ОМВД г. Гиссар","DIA in Hisor"],["ОМВД г. Истаравшан","DIA in Istaravshan"],["ОМВД г. Канибадам","DIA in Konibodom "],["ОМВД г. Пенджикент","DIA in Panjakent"],["ОМВД Дарвазского района","DIA in Darvoz "],["ОМВД района Деваштич","DIA in Devashtich"],["ОМВД г. Исфара","DIA in Isfara"],["ОМВД Кубодиёнского района","DIA in Qubodiyon"],["ОМВД Нурабадского района","DIA in Nurobod"],["ОМВД Раштского района","DIA in Rasht"],["ОМВД Самгар","DIA in Samgar"],["ОМВД Таджикабадского района","DIA in Tojikobod "],["ОМВД Турсунзаде","DIA Tursunzoda "],["ОМВД-1 г. Исфара","DIA-1 in Isfara"],["ОМВД  Яванcкого района","DIA in Yovon"],["ОМВД Вахшского района","DIA in Vakhsh"],["ОМВД района Дусти","DIA in Dusti"]];
let personal_data = {
    "passport": {},
    "patent": {},
    "migration_card": {}
};
let is_passport = false,
    is_migration_card = false,
    is_patent = false,
    supposed_values = [];
let other_docs_keywords = [
    /дмс|страхово[йе]|полис/i,
    /чек|платеж|плательщик/i,
    /перевод/i,
    /опись|расписка|уведомлен/i,
    /visas|владелец|гражданина/i,
    /holder/,   // это слово должно быть всегда чувствительным к регистру
    /анкет[аы]|соискателя/i,
    /работник/i,
];

let includes_passport_keywords = false,
    includes_patent_keywords = false,
    includes_migration_card_keywords = false,
    recognized_data_length = recognized_data.length;

function hasOtherKeywords(recognized_data, reg_exp_list) {
    for (let item of recognized_data) {
        for (let reg_exp of reg_exp_list) {
            if (reg_exp.test(item['text'])) {
                return true;
            }
        }
    }

    return false;
}

for (let item of recognized_data) {
    // отсутствие сравнения кол-ва ключей паспорта
    // с 0 позволяет обнаруживать дополнительные
    // титульные страницы паспортов, если паспорт
    // в документе не один
    if (/passport|паспорт|identity|личности/i.test(item['text'])) {
        includes_passport_keywords = true;
    }

    // 12 - общее количество распознаваемых полей паспорта
    if (Object.keys(personal_data['passport']).length > 0
        && Object.keys(personal_data['passport']).length < 12
        && /орган|authority|кем/i.test(item['text'])) {
        includes_passport_keywords = true;
    }

    if (Object.keys(personal_data['migration_card']).length === 0
        && /departure|migrat/i.test(item['text'])) {
        includes_migration_card_keywords = true;
    }

    if (Object.keys(personal_data['patent']).length === 0
        && /патент/i.test(item['text'])) {
        includes_patent_keywords = true;
    }

    // 13 - общее количество распознаваемых  полей патента
    if (Object.keys(personal_data['patent']).length > 0
        && Object.keys(personal_data['patent']).length < 13
        && /кем/i.test(item['text'])) {
        includes_patent_keywords = true;
    }

    if (
        includes_passport_keywords
        || includes_patent_keywords
        || includes_migration_card_keywords
    ) {
        break;
    }
}

let is_other_document = hasOtherKeywords(recognized_data, other_docs_keywords);

is_passport = includes_passport_keywords ? !is_other_document : is_passport;
is_patent = includes_patent_keywords ? !is_other_document : is_patent;
is_migration_card = includes_migration_card_keywords ? !is_other_document : is_migration_card;


// DefinePassportType

let is_paper_passport = false;
for (let i = 0; i < recognized_data_length; i++) {
    if (/type|country|code|личный/i.test(recognized_data[i]['text'])) {
        is_paper_passport = true;
        break;
    }
}


// DefineRUSPaperPassportCyrillicPage ( NEW )

let has_rus = false,
    has_surname = false,
    has_name = false,
    has_patronymic = false,
    is_rus_cyrillic_page = false;

for (let i = 0; i < recognized_data_length; i++) {
    if (/россии/i.test(recognized_data[i]['text'])) {
        has_rus = true;
    }

    if (/Фамилия/i.test(recognized_data[i]['text'])) {
        has_surname = true;
    }

    if (/Отчество/i.test(recognized_data[i]['text'])) {
        has_patronymic = true;
    }

    if (has_rus && has_surname
        && has_patronymic) {
        is_rus_cyrillic_page = true;
        break;
    }
}

// RecognizeRusPassport ( NEW )

let surname = null,
    name = null,
    middle_name = null,
    birth_place = null,
    issue_date = null,
    authority = null,
    authority_data = [],
    surname_data = [],
    name_data = [],
    middle_name_data = [],
    birth_place_data = [];

for (let i = 0; i < recognized_data_length; i++) {
    if (/фамилия/i.test(recognized_data[i]['text'])) {
        surname = recognized_data[i];
    }

    if (/имя/i.test(recognized_data[i]['text'])) {
        name = recognized_data[i];
        // Нет данных
    }

    if (/отчество/i.test(recognized_data[i]['text'])) {
        middle_name = recognized_data[i];
    }

    if (/рождения/i.test(recognized_data[i]['text'])) {
        birth_place = recognized_data[i];
        // Две даты ( первая - рождения, вторая дата выдачи)
    }

    if (/выдачи/i.test(recognized_data[i]['text'])) {
        issue_date = recognized_data[i];
    }

    if (/выдан/i.test(recognized_data[i]['text'])) {
        authority = recognized_data[i];
    }
}
// {"language":"ru","location":{"height":237,"width":39,"x":1433,"y":1017},"text":"богданов"}
// { language: 'ru', location: { height: 89, width: 18, x: 1467, y: 1404 }, text: 'Фамилия'} 387
for (let i = 0; i < recognized_data_length; i++) {
    if (surname
        && recognized_data[i]['location']['x'] <= surname['location']['x']
        && recognized_data[i]['location']['y'] >= surname['location']['y'] - 400
        && recognized_data[i]['location']['y'] <= surname['location']['y'] - 367) {
        surname_data.push(recognized_data[i]['text']);
    }

    if (name
        && recognized_data[i]['location']['x'] >= name['location']['x']
        && recognized_data[i]['location']['y'] >= name['location']['y'] + 20
        && recognized_data[i]['location']['y'] <= name['location']['y'] + 50) {
        name_data.push(recognized_data[i]['text']);
    }
    // {"language":"ru","location":{"height":289,"width":44,"x":1651,"y":1003},"text":"АЛЕКСЕЕВИЧ"}
    // {language: 'ru',location: { height: 96, width: 20, x: 1680, y: 1398 },text: 'Отчество'} 395
    if (middle_name
        && recognized_data[i]['location']['x'] <= middle_name['location']['x']
        && recognized_data[i]['location']['y'] >= middle_name['location']['y'] - 405
        && recognized_data[i]['location']['y'] <= middle_name['location']['y'] - 385) {
        middle_name_data.push(recognized_data[i]['text']);
    }
    // {"language":"ru","location":{"height":300,"width":42,"x":1734,"y":811},"text":"25.03.1963"}
    // {language: 'ru',location: { height: 104, width: 18, x: 1825, y: 1389 },text: 'рождения'} 578
    if (birth_place
        && recognized_data[i]['location']['x'] <= birth_place['location']['x']
        && recognized_data[i]['location']['y'] >= birth_place['location']['y'] - 588
        && recognized_data[i]['location']['y'] <= birth_place['location']['y'] - 568) {
        birth_place_data.push(recognized_data[i]['text']);
    }

    // {"language":"ru","location":{"height":52,"width":41,"x":424,"y":1468},"text":"ТП"} 571 720
    // {language: 'ru',location: { height: 66, width: 20, x: 450, y: 1716 },text: 'выдан'} 242
    if (authority
        && recognized_data[i]['location']['x'] >= authority['location']['x'] - 30
        && recognized_data[i]['location']['x'] <= authority['location']['x'] + 130
        && recognized_data[i]['location']['y'] >= authority['location']['y'] - 1100
        && recognized_data[i]['location']['y'] <= authority['location']['y'] - 200) {
        authority_data.push(recognized_data[i]['text']);
    }
}

if (surname_data.length > 0) {
    personal_data['passport']['surname'] = surname_data[surname_data.length - 1].toUpperCase();
} else {
    personal_data['passport']['surname'] = '-';
}

if (name_data.length > 0) {
    personal_data['passport']['name'] = name_data[name_data.length - 1].toUpperCase();;
} else {
    personal_data['passport']['name'] = '-';
}

if (middle_name_data.length > 0) {
    personal_data['passport']['middle_name'] = middle_name_data[middle_name_data.length - 1];
} else {
    personal_data['passport']['middle_name'] = '-';
}

if (birth_place_data.length > 0) {
    personal_data['passport']['birth_place'] = birth_place_data.join(' ')
        .split(' / ');

    if (personal_data['passport']['birth_place'].length > 1) {
        personal_data['passport']['birth_place'] = personal_data['passport']['birth_place'][1];
    } else {
        personal_data['passport']['birth_place'] = personal_data['passport']['birth_place'][0];
    }
} else {
    personal_data['passport']['birth_place'] = '-';
}

personal_data['passport']['authority'] = authority_data.length > 0 ? authority_data.join(' ').toUpperCase() : '-';

console.log(personal_data['passport'])